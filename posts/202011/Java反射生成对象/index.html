<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1" />
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <meta name="theme-color" content="#f9f9f9" />
    <title>WebStack-Hugo 网址导航</title>
    <link rel="shortcut icon" href="/assets/images/favicon.png" />
    <meta name="keywords" content="WebStack-Hugo 网址导航" />
    
    <meta name="baidu-site-verification" content="codeva-cCAOSG8MBO" />
    
    <link rel="stylesheet" id="block-library-css"
        href="/assets/css/block-library.min-5.6.2.css" type="text/css" media="all" />
    <link rel="stylesheet" id="iconfont-css" href="/assets/css/iconfont-3.03029.1.css"
        type="text/css" media="all" />
    <link rel="stylesheet" id="bootstrap-css" href="/assets/css/bootstrap.min-4.3.1.css"
        type="text/css" media="all" />
    <link rel="stylesheet" id="fancybox-css" href="/assets/css/fancybox.min-3.5.7.css"
        type="text/css" media="all" />
    <link rel="stylesheet" id="iowen-css" href="/assets/css/style-3.03029.1.css"
        type="text/css" media="all" />
    <link rel="stylesheet" id="custom-css" href="/assets/css/custom-style.css"
        type="text/css" media="all" />
    <link rel="stylesheet" id="fortawesome-css" href="/assets/fontawesome-5.15.4/css/all.min.css" type="text/css" />
    <script type="text/javascript" src="/assets/js/jquery.min-3.2.1.js" id="jquery-js"></script>
    <script type="text/javascript" src="/assets/js/content-search.js"  id="content-search-js"></script>
    
    <script>
        
        var _hmt = _hmt || [];
            (function () {
                var hm = document.createElement("script");
                hm.src = "https://hm.baidu.com/hm.js?efccc04cb44fc49faddac5876180b369";
                var s = document.getElementsByTagName("script")[0];
                s.parentNode.insertBefore(hm, s);
            })();
        
    </script>
    
    
     
    
    
    
    
</head>


<div class="main-content flex-fill grid-bg">
    <div class="big-header-banner">
        <div id="header" class="page-header sticky">
            <div class="navbar navbar-expand-md">
                <div class="container-fluid p-0">

                    <a href="" class="navbar-brand d-md-none" title="WebStack-Hugo 网址导航">
                        <img src="/assets/images/bt.png" class="logo-light"
                            alt="WebStack-Hugo 网址导航">
                        <img src="/assets/images/bt.png" class="logo-dark d-none"
                            alt="WebStack-Hugo 网址导航">
                    </a>

                    <div class="collapse navbar-collapse order-2 order-md-1">
                        <div class="header-mini-btn">
                            <label>
                                <input id="mini-button" type="checkbox">
                                <svg viewbox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                                    <path class="line--1" d="M0 40h62c18 0 18-20-17 5L31 55"></path>
                                    <path class="line--2" d="M0 50h80"></path>
                                    <path class="line--3" d="M0 60h62c18 0 18 20-17-5L31 45"></path>
                                </svg>
                            </label>

                        </div>

                        <ul class="navbar-nav site-menu" style="margin-right: 16px;">
                        
			<li >
				<a href="./">
                                    <i class="fa fa-home fa-lg mr-2"></i>
                                    <span>首页</span>
                                </a>
				<ul class="sub-menu">
				
				</ul>
			    </li>
			
			<li >
				<a href="https://www.jackssybin.cn/">
                                    <i class="fa fa-book fa-lg mr-2"></i>
                                    <span>作者</span>
                                </a>
				<ul class="sub-menu">
				
				</ul>
			    </li>
			
			<li class="menu-item-has-children">
				<a href="">
                                    <i class="fa fa-cog fa-lg mr-2"></i>
                                    <span>配置</span>
                                </a>
				<ul class="sub-menu">
				
				    <li><a href="#">源码</a></li>
				
				    <li><a href="#">图标</a></li>
				
				</ul>
			    </li>
			
			</ul>

                        
                        <div class="rounded-circle weather">
                            <div id="he-plugin-simple" style="display: contents;"></div>
                            <script>WIDGET = {
                                    CONFIG: {
                                        "modules": "01234",
                                        "background": 5,
                                        "tmpColor": "E4C600",
                                        "tmpSize": 14,
                                        "cityColor": "E4C600",
                                        "citySize": 14,
                                        "aqiColor": "#E4C600",
                                        "aqiSize": 14,
                                        "weatherIconSize": 24,
                                        "alertIconSize": 18,
                                        "padding": "10px 10px 10px 10px",
                                        "shadow": "1",
                                        "language": "auto",
                                        "borderRadius": 5,
                                        "fixed": "false",
                                        "vertical": "middle",
                                        "horizontal": "left",
                                        "key": "085791e805a24491b43b06cf58ab31e7"
                                    }
                                }
                            </script>
                            <script src="https://widget.qweather.net/simple/static/js/he-simple-common.js?v=2.0"></script>
                        </div>
                        
                    </div>

                    <ul class="nav navbar-menu text-xs order-1 order-md-2">
                        
                        
                        <li class="nav-item mr-3 mr-lg-0 d-none d-lg-block">
                            <script>
                                fetch('https://v1.hitokoto.cn')
                                    .then(response => response.json())
                                    .then(data => {
                                    const hitokoto = document.getElementById('hitokoto_text')
                                    hitokoto.href = 'https://hitokoto.cn/?uuid=' + data.uuid
                                    hitokoto.innerText = data.hitokoto
                                    })
                                    .catch(console.error)
                            </script>                           
                            <div id="hitokoto"><a href="#" target="_blank" id="hitokoto_text">疏影横斜水清浅，暗香浮动月黄昏。</a></div>
                        </li>
                        
                        
                        <li class="nav-search ml-3 ml-md-4">
                            <a href="javascript:" data-toggle="modal" data-target="#search-modal"><i
                                    class="iconfont icon-search icon-2x"></i></a>
                        </li>
                        <li class="nav-item d-md-none mobile-menu ml-3 ml-md-4">
                            <a href="javascript:" id="sidebar-switch" data-toggle="modal"
                                data-target="#sidebar"><i class="iconfont icon-classification icon-2x"></i></a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
        <div class="placeholder" style="height:74px"></div>
    </div>


<body class="page-body boxed-container">
    <main role="main" class="flex-shrink-0">
    <div class="container">
        <h1 class="mt-5"></h1>
        <div class="content">
            <h2 id="permalink-articles202011101605006483827html">title: Java反射生成对象
date: &lsquo;2020-11-10 19:08:04&rsquo;
updated: &lsquo;2020-11-19 09:47:23&rsquo;
tags: [java, 反射, 对象创建, 声明方法使用]
permalink: /articles/2020/11/10/1605006483827.html</h2>
<p><img src="https://b3logfile.com/bing/20190327.jpg?imageView2/1/w/960/h/540/interlace/1/q/100" alt=""></p>
<p>想要了解反射生成class和创建java对象，首先我们要了解什么是反射？</p>
<p><strong>一、什么是反射？</strong></p>
<p>Java反射说的是在运行状态中，对于任何一个类，我们都能够知道这个类有哪些方法和属性。对于任何一个对象，我们都能够对它的方法和属性进行调用。<strong>我们把这种动态获取对象信息和调用对象方法的功能称之为反射机制。</strong></p>
<p><strong>二、反射生成Class的三种方式</strong></p>
<p><strong>1.第一种方式（利用getClass（）方法）</strong></p>
<pre tabindex="0"><code>User user = new User();
Class class= user.getClass();
</code></pre><p><strong>2.第二种方式（直接对象的.class）</strong></p>
<pre tabindex="0"><code>Class cla = User.class
</code></pre><p><strong><strong>3.第三种方式（Class.forName()）</strong></strong></p>
<pre tabindex="0"><code>Class cla = Class.forName(&#34;com.jackssy.User&#34;);
</code></pre><p>注意：此种方法通过对象的全路径来获取Class的，当对象不存在时，会出现ClassNotFoundException异常。详细的可以看下Class.forName()的底层代码。</p>
<p><strong>三、反射生成java对象的两种方式</strong></p>
<p><strong>1.第一种方式newInstance();</strong></p>
<p><code>调用public``无参构造器 ，若是没有，则会报异常</code></p>
<p><code>Object o = clazz.newInstance();　</code></p>
<p><code>没有无参构造函数异常：</code></p>
<p><strong>2.第二种方式：</strong></p>
<p>有带参数的构造函数的类，先获取到其构造对象，再通过该构造方法类获取实例：</p>
<p>/ /获取构造函数类的对象</p>
<p>Constroctor constroctor = User.class.getConstructor(String.class);</p>
<p>// 使用构造器对象的newInstance方法初始化对象</p>
<p>Object obj = constroctor.newInstance(&ldquo;name&rdquo;);</p>
<p><strong>四、使用reflectasm调用生成对象调用</strong>
<strong>1. 依赖</strong></p>
<pre tabindex="0"><code>&lt;dependency&gt;
            &lt;groupId&gt;com.esotericsoftware&lt;/groupId&gt;
            &lt;artifactId&gt;reflectasm&lt;/artifactId&gt;
            &lt;version&gt;1.11.9&lt;/version&gt;
        &lt;/dependency&gt;
</code></pre><p><strong>2.代码</strong></p>
<pre tabindex="0"><code>import com.esotericsoftware.reflectasm.MethodAccess;
import org.junit.Before;
import org.junit.Test;
<p>import java.beans.BeanInfo;
import java.beans.IntrospectionException;
import java.beans.Introspector;
import java.beans.PropertyDescriptor;
import java.lang.reflect.InvocationTargetException;
import java.lang.reflect.Method;
import java.math.BigDecimal;</p>
<p>public class TestInvoke {
private long times = 100000000L;//1 亿
//    private long times = 100_000L;
private SimpleBean bean;
private LcProduct lcProduct;
private String formatter = &quot;%s %d times using %d ms&quot;;</p>
<p>@Before
public void setUp() throws Exception {
bean = new SimpleBean();
bean.setName(&quot;haoyifen&quot;);
lcProduct = new LcProduct();
lcProduct.setPrdCode(&quot;prdcode12&quot;);
lcProduct.setPrdType(&quot;prdtype12&quot;);
lcProduct.setTaCode(&quot;tacode12&quot;);
lcProduct.setPrdName(&quot;prdname12&quot;);
lcProduct.setCurrType(&quot;currtype123&quot;);
lcProduct.setNav(new BigDecimal(&quot;12&quot;));
lcProduct.setTotNav(new BigDecimal(&quot;12&quot;));
lcProduct.setInCome(new BigDecimal(&quot;12&quot;));
lcProduct.setInComeUnit(new BigDecimal(&quot;12&quot;));
lcProduct.setInComeRate(new BigDecimal(&quot;12&quot;));</p>
<p>}</p>
<p>//直接通过Java的get方法
@Test
public void directGet() {
long start = System.currentTimeMillis();
for (long i = 0; i &lt; times; i++) {
bean.getName();
}
long end = System.currentTimeMillis();
System.out.println((end-start));
}</p>
<p>//通过高性能的ReflectAsm库进行测试，仅进行一次methodAccess获取
@Test
public void reflectAsmGet() {
MethodAccess methodAccess = MethodAccess.get(SimpleBean.class);
long star = System.currentTimeMillis();
for (long i = 0; i &lt; times; i++) {
methodAccess.invoke(bean, &quot;getName&quot;);
}
long end = System.currentTimeMillis();
System.out.println((end - star) / 1000);
}
@Test
public void reflectAsmGetTest() {</p>
<p>MethodAccess methodAccess = MethodAccess.get(SimpleBean.class);
int index = methodAccess.getIndex(&quot;getName&quot;);</p>
<p>//        clock.start(&quot;获取方法&quot;);
//        Arrays.stream(methodAccess.getMethodNames()).forEach(xx-&gt; {
//            if(xx.startsWith(&quot;get&quot;)){
////                System.out.print(xx+&quot; :&quot;+methodAccess.invoke(lcProduct,xx)+&quot; &quot;);;
//                methodAccess.invoke(lcProduct,xx);
//            }
//        });
//        clock.stop();
long start = System.currentTimeMillis();
methodAccess.invoke(bean, index);
for (long i = 0; i &lt; times; i++) {</p>
<p>//            methodAccess.invoke(bean, index);
methodAccess.invoke(bean,&quot;getName&quot;);</p>
<p>}
long end = System.currentTimeMillis();
System.out.println((end - start) );
}</p>
<p>//通过Java Class类自带的反射获得Method测试，仅进行一次method获取
@Test
public void javaReflectGet() throws Exception {
Method getName = SimpleBean.class.getMethod(&quot;getName&quot;);</p>
<p>//        Arrays.stream(LcProduct.class.getMethods()).forEach(xx-&gt;{
//            if(xx.getName().startsWith(&quot;get&quot;)){
//                try {
//                    xx.invoke(lcProduct);
//                } catch (IllegalAccessException e) {
//                    e.printStackTrace();
//                } catch (InvocationTargetException e) {
//                    e.printStackTrace();
//                }
//            }
//        });</p>
<p>long start = System.currentTimeMillis();
for (long i = 0; i &lt; times; i++) {
getName.invoke(bean);
}
long end = System.currentTimeMillis();
System.out.println((end - start) );
}</p>
<p>//使用Java自带的Property属性获取Method测试，仅进行一次method获取
@Test
public void propertyGet() throws IllegalAccessException, NoSuchMethodException, InvocationTargetException, IntrospectionException {
Method method = null;
BeanInfo beanInfo = Introspector.getBeanInfo(SimpleBean.class);
PropertyDescriptor[] propertyDescriptors = beanInfo.getPropertyDescriptors();
for (PropertyDescriptor propertyDescriptor : propertyDescriptors) {
if (propertyDescriptor.getName().equals(&quot;name&quot;)) {
method = propertyDescriptor.getReadMethod();
break;
}
}
long start = System.currentTimeMillis();
for (long i = 0; i &lt; times; i++) {</p>
<pre><code>    method.invoke(bean);
}
long end = System.currentTimeMillis();
System.out.println((end - start) );
</code></pre>
<p>}</p>
<p>//BeanUtils的getProperty测试
@Test
public void beanUtilsGet() throws IllegalAccessException, NoSuchMethodException, InvocationTargetException {
long start = System.currentTimeMillis();
for (long i = 0; i &lt; times; i++) {</p>
<p>//            BeanUtils.getProperty(bean, &quot;name&quot;);
}
long end = System.currentTimeMillis();
System.out.println((end - start) );
}</p>
<p>@Test
public void allTest() throws Exception {
javaReflectGet();
reflectAsmGetTest();
directGet();
}</p>
<p>}</p>
<p>public class SimpleBean {
private String name;
public String getName() {
return name;
}
public void setName(String name) {
this.name = name;
}
}</p>
<p>public class LcProduct {</p>
<p>private Long id;
private String prdCode;
private String prdType;
private String taCode;
private String prdName;
private String currType;</p>
<p>private BigDecimal nav = new BigDecimal(0).setScale(12);
private BigDecimal  totNav= new BigDecimal(0).setScale(12);;
private BigDecimal  inCome= new BigDecimal(0).setScale(12);
private BigDecimal  inComeUnit= new BigDecimal(0).setScale(12);
private BigDecimal  inComeRate= new BigDecimal(0).setScale(12);
private String batchCode;
private Boolean updateFlag;</p>
<p>private LocalDateTime createdAt;
private String createdBy;</p>
<p>private LocalDateTime updatedAt;
private String updatedBy;
}
//省略 getset方法
</code></pre><p><strong>3.结论</strong>
每种方式执行1亿次运行结果如下：</p></p>
<ul>
<li>get耗时35ms</li>
<li>缓存反射耗时223ms</li>
<li>reflectasm先拿到方法index反射耗时39ms</li>
<li>reflectasm每次按照方法名查找然后反射耗时350ms</li>
<li>reflectasm相比通过名称来访问成员，使用索引的方式会更快。如果需要重复地访问同一个成员，那么通过索引来访问该成员效率更高</li>
</ul>
<p><strong>4.reflectasm原理为啥这么快</strong>
jdk反射慢原因有三:
1.变长参数方法导致的 Object 数组
2.基本类型的自动装箱、拆箱
3.还有最重要的方法内联
reflectasm快原因:
ReflectASM是一个很小的java类库，主要是通过asm生产类来实现java反射。他的主要代码还是get方法，但是由于get方法源码比较多，就不在博客中贴出来了，大家可以自己点进去看。这里我们给出实现invoke的抽象方法。</p>
<pre tabindex="0"><code>// Decompiled by Jad v1.5.8g. Copyright 2001 Pavel Kouznetsov.  
// Jad home page: http://www.kpdus.com/jad.html  
// Decompiler options: packimports(3)   
<p>package com.johhny.ra;</p>
<p>import com.esotericsoftware.reflectasm.MethodAccess;</p>
<p>// Referenced classes of package com.johhny.ra:<br>
//            User</p>
<p>public class UserMethodAccess extends MethodAccess<br>
{</p>
<pre><code>public UserMethodAccess()  
{  
}  

/** 
 * 这个方法是主要是实现了MethodAccess 的抽象方法，来实现反射的功能   
 * @param obj  需要反射的对象 
 * @param i  class.getDeclaredMethods 对应方法的index 
 * @param 参数对象集合 
 * @return 
 */  
public transient Object invoke(Object obj, int i, Object aobj[])  
{  
    User user = (User)obj;  
    switch(i)  
    {  
    case 0: // &amp;#39;\0&amp;#39;  
        return user.getName();  

    case 1: // &amp;#39;\001&amp;#39;  
        return Integer.valueOf(user.getId());  

    case 2: // &amp;#39;\002&amp;#39;  
        user.setName((String)aobj[0]);  
        return null;  

    case 3: // &amp;#39;\003&amp;#39;  
        user.setId(((Integer)aobj[0]).intValue());  
        return null;  
    }  
    throw new IllegalArgumentException((new StringBuilder(&amp;#34;Method not found: &amp;#34;)).append(i).toString());  
}  
</code></pre>
<p>}
</code></pre><p>由代码可以看出来，实际上ReflectASM就是把类的各个方法缓存起来，然后通过case选择，直接调用，因此速度会快上很多。但是它的get方法同样会消耗很大的时间，因此就算是使用ReflectASM的朋友也记得请在启动的时候就初始化get方法计入缓存</p></p>
<h5 id="读写字段">读写字段</h5>
<p>通过 FieldAccess 可以读写类的字段：</p>
<pre tabindex="0"><code>SomeClass someObject = // ...
FieldAccess access = FieldAccess.get(SomeClass.class);
access.set(someObject, &#34;name&#34;, &#34;Huey&#34;);
String name = (String) access.get(someObject, &#34;name&#34;);
assertEquals(name, &#34;Huey&#34;);
</code></pre><h5 id="调用方法">调用方法</h5>
<p>通过 MethodAccess 可以调用对象实例的方法：</p>
<pre tabindex="0"><code>SomeClass someObject = // ...
MethodAccess access = MethodAccess.get(SomeClass.class);
access.invoke(someObject, &#34;setName&#34;, &#34;Huey&#34;);
String name = (String) access.invoke(someObject, &#34;getName&#34;);
assertEquals(name, &#34;Huey&#34;);
</code></pre><h5 id="构造实例">构造实例</h5>
<p>通过 ConstructorAccess 可以构造对象实例：</p>
<pre tabindex="0"><code>ConstructorAccess access = ConstructorAccess.get(SomeClass.class);
SomeClass someObject = access.newInstance();
// do something with someObject.
</code></pre><h5 id="索引">索引</h5>
<p>相比通过名称来访问成员，使用索引的方式会更快。如果需要重复地访问同一个成员，那么通过索引来访问该成员效率更高：</p>
<pre tabindex="0"><code>String[] names = // ...
SomeClass someObject = // ...
MethodAccess access = MethodAccess.get(SomeClass.class);
int addNameIndex = access.getIndex(&#34;addName&#34;);
for (String name : names) {
    access.invoke(someObject, addNameIndex, name);
}
</code></pre><h5 id="遍历字段">遍历字段</h5>
<p>遍历一个类的所有字段：</p>
<pre tabindex="0"><code>FieldAccess access = FieldAccess.get(SomeClass.class);
for(int i = 0, n = access.getFieldCount(); i &lt; n; i++) {
    access.set(instanceObject, i, valueToPut);              
}
</code></pre>
        </div>
    </div>
    </main>

    <style>
        .content {
            font-size: 1.25rem;
          }
          
          .content h1,
          .content h2,
          .content h3,
          .content h4 {
            margin: 15px 10px 5px;
          }
          
    </style>

        <footer class="main-footer footer-type-1 text-xs">
            <div id="footer-tools" class="d-flex flex-column">
                <a href="javascript:" id="go-to-up" class="btn rounded-circle go-up m-1" rel="go-top">
                    <i class="iconfont icon-to-up"></i>
                </a>
                
                <a href="javascript:" data-toggle="modal" data-target="#search-modal" class="btn rounded-circle m-1"
                    rel="search" one-link-mark="yes">
                    <i class="iconfont icon-search"></i>
                </a>
                <a href="https://www.yuque.com/shenweiyan" class="btn rounded-circle kefu m-1" target="_blank" data-toggle="tooltip" data-placement="left" title="联系我们">
                    <i class="mode-ico iconfont icon-qq"></i>
                </a>
                
                
		<a href="javascript:" onclick="window.location.href='javascript:switchNightMode()'" class="btn rounded-circle switch-dark-mode m-1" id="yejian"
                    data-toggle="tooltip" data-placement="left" title="日间模式">
                    <i class="mode-ico iconfont icon-night"></i>
                </a>
                
            </div>
            <div class="footer-inner">
                <div class="footer-text">本站内容源自互联网，如有内容侵犯了你的权益，请联系删除相关内容，联系邮箱：jackxiazhou@yeah.net <br/>© 2023 - 2024 By <a href="https://github.com/shenweiyan/WebStack-Hugo">WebStack-Hugo</a> | <a href="https://www.bioitee.com/">Bio IT 爱好者</a> | <a href="http://beian.miit.gov.cn/">京ICP备17039180号-1</a><br/></div>
            </div>
        </footer>
    </div>
</div>


<script type='text/javascript' src='/assets/js/jquery.ui.touch-punch.min-0.2.2.js' id='jqueryui-touch-js'></script>
<script type='text/javascript' src='/assets/js/clipboard.min-5.6.2.js' id='clipboard-js'></script>
<script type='text/javascript' src='/assets/js/tooltip-extend.js' id='iplaycode-nav-js'></script>
<script type='text/javascript' id='popper-js-extra'>
 

var theme = {"ajaxurl":"","addico":"https:\/\/nav.baidu.cn\/wp-content\/themes\/onenav\/images\/add.png","order":"asc","formpostion":"top","defaultclass":"io-grey-mode","isCustomize":"1","icourl":"","icopng":".png","urlformat":"1","customizemax":"10","newWindow":"0","lazyload":"1","minNav":"1","loading":"1","hotWords":"baidu","classColumns":" col-sm-6 col-md-4 col-xl-5a col-xxl-6a ","apikey":"TWpBeU1UVTNOekk1TWpVMEIvZ1M2bFVIQllUMmxsV1dZelkxQTVPVzB3UW04eldGQmxhM3BNWW14bVNtWk4="};
 
</script>
<script type='text/javascript' src='/assets/js/popper.min.js' id='popper-js'></script>
<script type='text/javascript' src='/assets/js/bootstrap.min-4.3.1.js' id='bootstrap-js'></script>
<script type='text/javascript' src='/assets/js/theia-sticky-sidebar-1.5.0.js' id='sidebar-js'></script>
<script type='text/javascript' src='/assets/js/lazyload.min-12.4.0.js' id='lazyload-js'></script>
<script type='text/javascript' src='/assets/js/fancybox.min-3.5.7.js' id='lightbox-js-js'></script>

<script type='text/javascript' src='/assets/js/app-mini.js' id='appmini-js'></script>

<script type="text/javascript">
    $(document).ready(function(){
        var siteWelcome = $('#loading');
        siteWelcome.addClass('close');
        setTimeout(function() {
            siteWelcome.remove();
        }, 600);
    });
</script>
<script>        
    $(document).ready(function(){
        setTimeout(function () {
            if ($('a.smooth[href="' + window.location.hash + '"]')[0]) {
                $('a.smooth[href="' + window.location.hash + '"]').click();
            }else if (window.location.hash != '') {
                $("html, body").animate({
                    scrollTop: $(window.location.hash).offset().top - 90
                }, {
                    duration: 500,
                    easing: "swing"
                });
            }
        }, 300);
        $(document).on('click','a.smooth',function(ev) {
            if($('#sidebar').hasClass('show') && !$(this).hasClass('change-href')){
                $('#sidebar').modal('toggle');
            }
            if($(this).attr("href").substr(0, 1) == "#"){
                $("html, body").animate({
                    scrollTop: $($(this).attr("href")).offset().top - 90
                }, {
                    duration: 500,
                    easing: "swing"
                });
            }
            if($(this).hasClass('go-search-btn')){
                $('#search-text').focus();
            }
            if(!$(this).hasClass('change-href')){
                var menu =  $("a"+$(this).attr("href"));
                menu.click();
                toTarget(menu.parent().parent(),true,true);
            }
        });
        $(document).on('click','a.tab-noajax',function(ev) {
            var url = $(this).data('link');
            if(url)
                $(this).parents('.d-flex.flex-fill.flex-tab').children('.btn-move.tab-move').show().attr('href', url);
            else
                $(this).parents('.d-flex.flex-fill.flex-tab').children('.btn-move.tab-move').hide();
        });
        
    });
</script>

<script>

(function(){
    if(document.cookie.replace(/(?:(?:^|.*;\s*)night\s*\=\s*([^;]*).*$)|^.*$/, "$1") === ''){
        if(new Date().getHours() > 22 || new Date().getHours() < 6){
            document.body.classList.remove('io-black-mode');
            document.body.classList.add('io-grey-mode');
            document.cookie = "night=1;path=/";
            console.log('夜间模式开启');
        }else{
            document.body.classList.remove('night');
            document.cookie = "night=0;path=/";
            console.log('夜间模式关闭');
        }
    }else{
        var night = document.cookie.replace(/(?:(?:^|.*;\s*)night\s*\=\s*([^;]*).*$)|^.*$/, "$1") || '0';
        if(night == '0'){
            document.body.classList.remove('night');
        }else if(night == '1'){
            document.body.classList.add('night');
        }
    }
})();

$("#search-bg").css("background-image", "url(assets\/images\/bg-dna.jpg)");   
function switchNightMode(){
    var night = document.cookie.replace(/(?:(?:^|.*;\s*)night\s*\=\s*([^;]*).*$)|^.*$/, "$1") || '0';
    if(night == '0'){
	$("#search-bg").css("background-image", "url(assets\/images\/bg-dna.jpg)");
        document.body.classList.remove('io-grey-mode');
        document.body.classList.add('io-black-mode');
        document.cookie = "night=1;path=/"
        console.log(' ');
        $(".switch-dark-mode").attr("data-original-title","日间模式");
        $(".mode-ico").removeClass("icon-night");
        $(".mode-ico").addClass("icon-light");
    }else{
	$("#search-bg").css("background-image", "url(assets\/images\/bg-dna.jpg)")
        document.body.classList.remove('io-black-mode');
        document.body.classList.add('io-grey-mode');
        document.cookie = "night=0;path=/"
        console.log(' ');
        $(".switch-dark-mode").attr("data-original-title","夜间模式");
        $(".mode-ico").removeClass("icon-light");
        $(".mode-ico").addClass("icon-night");
    }
}
</script>
</body>
</html>

