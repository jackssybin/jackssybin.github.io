<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1" />
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <meta name="theme-color" content="#f9f9f9" />
    <title>WebStack-Hugo 网址导航</title>
    <link rel="shortcut icon" href="/assets/images/favicon.png" />
    <meta name="keywords" content="WebStack-Hugo 网址导航" />
    
    <meta name="baidu-site-verification" content="codeva-cCAOSG8MBO" />
    
    <link rel="stylesheet" id="block-library-css"
        href="/assets/css/block-library.min-5.6.2.css" type="text/css" media="all" />
    <link rel="stylesheet" id="iconfont-css" href="/assets/css/iconfont-3.03029.1.css"
        type="text/css" media="all" />
    <link rel="stylesheet" id="bootstrap-css" href="/assets/css/bootstrap.min-4.3.1.css"
        type="text/css" media="all" />
    <link rel="stylesheet" id="fancybox-css" href="/assets/css/fancybox.min-3.5.7.css"
        type="text/css" media="all" />
    <link rel="stylesheet" id="iowen-css" href="/assets/css/style-3.03029.1.css"
        type="text/css" media="all" />
    <link rel="stylesheet" id="custom-css" href="/assets/css/custom-style.css"
        type="text/css" media="all" />
    <link rel="stylesheet" id="fortawesome-css" href="/assets/fontawesome-5.15.4/css/all.min.css" type="text/css" />
    <script type="text/javascript" src="/assets/js/jquery.min-3.2.1.js" id="jquery-js"></script>
    <script type="text/javascript" src="/assets/js/content-search.js"  id="content-search-js"></script>
    
    <script>
        
        var _hmt = _hmt || [];
            (function () {
                var hm = document.createElement("script");
                hm.src = "https://hm.baidu.com/hm.js?efccc04cb44fc49faddac5876180b369";
                var s = document.getElementsByTagName("script")[0];
                s.parentNode.insertBefore(hm, s);
            })();
        
    </script>
    
    
     
    
    
    
    
</head>


<div class="main-content flex-fill grid-bg">
    <div class="big-header-banner">
        <div id="header" class="page-header sticky">
            <div class="navbar navbar-expand-md">
                <div class="container-fluid p-0">

                    <a href="" class="navbar-brand d-md-none" title="WebStack-Hugo 网址导航">
                        <img src="/assets/images/bt.png" class="logo-light"
                            alt="WebStack-Hugo 网址导航">
                        <img src="/assets/images/bt.png" class="logo-dark d-none"
                            alt="WebStack-Hugo 网址导航">
                    </a>

                    <div class="collapse navbar-collapse order-2 order-md-1">
                        <div class="header-mini-btn">
                            <label>
                                <input id="mini-button" type="checkbox">
                                <svg viewbox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                                    <path class="line--1" d="M0 40h62c18 0 18-20-17 5L31 55"></path>
                                    <path class="line--2" d="M0 50h80"></path>
                                    <path class="line--3" d="M0 60h62c18 0 18 20-17-5L31 45"></path>
                                </svg>
                            </label>

                        </div>

                        <ul class="navbar-nav site-menu" style="margin-right: 16px;">
                        
			<li >
				<a href="./">
                                    <i class="fa fa-home fa-lg mr-2"></i>
                                    <span>首页</span>
                                </a>
				<ul class="sub-menu">
				
				</ul>
			    </li>
			
			<li >
				<a href="https://www.jackssybin.cn/">
                                    <i class="fa fa-book fa-lg mr-2"></i>
                                    <span>作者</span>
                                </a>
				<ul class="sub-menu">
				
				</ul>
			    </li>
			
			<li class="menu-item-has-children">
				<a href="">
                                    <i class="fa fa-cog fa-lg mr-2"></i>
                                    <span>配置</span>
                                </a>
				<ul class="sub-menu">
				
				    <li><a href="#">源码</a></li>
				
				    <li><a href="#">图标</a></li>
				
				</ul>
			    </li>
			
			</ul>

                        
                        <div class="rounded-circle weather">
                            <div id="he-plugin-simple" style="display: contents;"></div>
                            <script>WIDGET = {
                                    CONFIG: {
                                        "modules": "01234",
                                        "background": 5,
                                        "tmpColor": "E4C600",
                                        "tmpSize": 14,
                                        "cityColor": "E4C600",
                                        "citySize": 14,
                                        "aqiColor": "#E4C600",
                                        "aqiSize": 14,
                                        "weatherIconSize": 24,
                                        "alertIconSize": 18,
                                        "padding": "10px 10px 10px 10px",
                                        "shadow": "1",
                                        "language": "auto",
                                        "borderRadius": 5,
                                        "fixed": "false",
                                        "vertical": "middle",
                                        "horizontal": "left",
                                        "key": "085791e805a24491b43b06cf58ab31e7"
                                    }
                                }
                            </script>
                            <script src="https://widget.qweather.net/simple/static/js/he-simple-common.js?v=2.0"></script>
                        </div>
                        
                    </div>

                    <ul class="nav navbar-menu text-xs order-1 order-md-2">
                        
                        
                        <li class="nav-item mr-3 mr-lg-0 d-none d-lg-block">
                            <script>
                                fetch('https://v1.hitokoto.cn')
                                    .then(response => response.json())
                                    .then(data => {
                                    const hitokoto = document.getElementById('hitokoto_text')
                                    hitokoto.href = 'https://hitokoto.cn/?uuid=' + data.uuid
                                    hitokoto.innerText = data.hitokoto
                                    })
                                    .catch(console.error)
                            </script>                           
                            <div id="hitokoto"><a href="#" target="_blank" id="hitokoto_text">疏影横斜水清浅，暗香浮动月黄昏。</a></div>
                        </li>
                        
                        
                        <li class="nav-search ml-3 ml-md-4">
                            <a href="javascript:" data-toggle="modal" data-target="#search-modal"><i
                                    class="iconfont icon-search icon-2x"></i></a>
                        </li>
                        <li class="nav-item d-md-none mobile-menu ml-3 ml-md-4">
                            <a href="javascript:" id="sidebar-switch" data-toggle="modal"
                                data-target="#sidebar"><i class="iconfont icon-classification icon-2x"></i></a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
        <div class="placeholder" style="height:74px"></div>
    </div>


<body class="page-body boxed-container">
    <main role="main" class="flex-shrink-0">
    <div class="container">
        <h1 class="mt-5"></h1>
        <div class="content">
            <h2 id="permalink-articles201909231569230256915html">title: 如何定位java进程中使用最耗内存的进程
date: &lsquo;2019-09-23 17:17:37&rsquo;
updated: &lsquo;2019-11-18 11:06:56&rsquo;
tags: [java, jstack, 线程, 调优]
permalink: /articles/2019/09/23/1569230256915.html</h2>
<h3 id="1清除进程和线程的关系">1.清除进程和线程的关系</h3>
<h3 id="2知道linux查看进程对应线程的命令">2.知道linux查看进程对应线程的命令</h3>
<p>查看进程命令</p>
<pre tabindex="0"><code>ps -ef |grep java
</code></pre><p>查看进程对应线程命令</p>
<pre tabindex="0"><code>top -Hp &lt;pid&gt;
</code></pre><p>找到最大线程的pid号</p>
<h3 id="3打印堆栈信息">3.打印堆栈信息</h3>
<pre tabindex="0"><code>jstack &lt;pid&gt;
</code></pre><p>jstack 里面存的是16进制的数字。所以需要把十进制转换为16进制</p>
<pre tabindex="0"><code>printf &#34;%x\n&#34; pid
jstack pid |grep &#39;nid&#39; -C5 –color
</code></pre><p>找到了16进制的pid号。那就直接可以在jstack里搜索找到对应进程信息了，就能找到对应的代码了</p>
<p><strong>生成dump文件：</strong></p>
<pre tabindex="0"><code> jmap -dump:format=b,file=/path/heap.bin 进程ID
<p>jmap -dump:live,format=b,file=/path/heap.bin 进程ID
</code></pre><p><strong>live参数：</strong></p></p>
<p>表示我们需要抓取目前在生命周期内的内存对象,也就是说GC收不走的对象,然后我们绝大部分情况下,需要的看的就是这些内存。而且会减小dump文件的大小。</p>
<h3 id="4案例">4.案例</h3>
<ul>
<li>
<p>背景</p>
</li>
<li>
<p>1、java 正则表达式回溯造成 CPU 100%</p>
</li>
<li>
<p>2、线程死锁，程序 hang 住</p>
</li>
<li>
<p>3、免费实用的脚本工具大礼包</p>
</li>
<li>
<p>（1）show-duplicate-java-classes</p>
</li>
<li>
<p>（2）find-in-jars</p>
</li>
<li>
<p>（3）housemd pid [java_home]</p>
</li>
<li>
<p>（4）jvm pid</p>
</li>
<li>
<p>（5）greys[@IP:PORT]</p>
</li>
<li>
<p>（6）sjksjk &ndash;commands sjk &ndash;help</p>
</li>
</ul>
<pre tabindex="0"><code>#查线程cpu100  4步走
1. top oder by with P：1040 // 首先按进程负载排序找到  axLoad(pid)  
2. top -Hp 进程PID：1073    // 找到相关负载 线程PID  
3. printf “0x%x\n”线程PID： 0x431  // 将线程PID转换为 16进制，为后面查找 jstack 日志做准备  
4. jstack  进程PID | vim +/十六进制线程PID -        // 例如：jstack 1040|vim +/0x431 -
</code></pre><p><strong>工具：</strong>
show-busy-java-threads.sh（<a href="https://github.com/oldratlee/useful-scripts">https://github.com/oldratlee/useful-scripts</a>）
<strong>示例代码：</strong></p>
<pre tabindex="0"><code>import java.util.ArrayList;  
import java.util.List;  
import java.util.regex.Matcher;  
import java.util.regex.Pattern;  
public class RegexLoad {  
    public static void main(String[] args) {  
        String[] patternMatch = {&#34;([\\w\\s]+)+([+\\-/*])+([\\w\\s]+)&#34;,  
                &#34;([\\w\\s]+)+([+\\-/*])+([\\w\\s]+)+([+\\-/*])+([\\w\\s]+)&#34;};  
        List&lt;String&gt; patternList = new ArrayList&lt;String&gt;();  
<p>        patternList.add(&quot;Avg Volume Units product A + Volume Units product A&quot;);<br>
        patternList.add(&quot;Avg Volume Units /  Volume Units product A&quot;);<br>
        patternList.add(&quot;Avg retailer On Hand / Volume Units Plan / Store Count&quot;);<br>
        patternList.add(&quot;Avg Hand Volume Units Plan Store Count&quot;);<br>
        patternList.add(&quot;1 - Avg merchant Volume Units&quot;);<br>
        patternList.add(&quot;Total retailer shipment Count&quot;);</p>
<p>        for (String s :patternList ){</p>
<p>            for(int i=0;i&lt;patternMatch.length;i++){<br>
                Pattern pattern = Pattern.compile(patternMatch[i]);</p>
<p>                Matcher matcher = pattern.matcher(s);<br>
                System.out.println(s);<br>
                if (matcher.matches()) {</p>
<p>                    System.out.println(&quot;Passed&quot;);<br>
                }else<br>
                    System.out.println(&quot;Failed;&quot;);<br>
            }</p>
<p>        }<br>
    }<br>
}
</code></pre><p>编译javac RegexLoad.java  &amp;java RegexLoad 运行之后。top发现占用cpu99的一个java进程
工具使用</p></p>
<pre tabindex="0"><code>第一次执行。我的返回了 sh编译错误，兼容性问题，因为linux将sh默认指向了dash，而不是bash
root@iZ2ze8um4r4f2fiahuutedZ:~/data/java/useful-scripts# sh show-busy-java-threads
show-busy-java-threads: 13: show-busy-java-threads: Syntax error: &#34;(&#34; unexpected
通过
在root下面执行 dpkg-reconfigure dash,选择no 解决问题。继续执行
sh show-busy-java-threads.sh 
立即定位到了繁忙的进程
</code></pre><p><strong>工具使用api说明：</strong></p>
<pre tabindex="0"><code>show-busy-java-threads.sh  
# 从 所有的 Java进程中找出最消耗CPU的线程（缺省5个），打印出其线程栈。    
show-busy-java-threads.sh -c &lt;要显示的线程栈数&gt;  
show-busy-java-threads.sh -c &lt;要显示的线程栈数&gt; -p &lt;指定的Java Process&gt;  
# -F选项：执行jstack命令时加上-F选项（强制jstack），一般情况不需要使用  
show-busy-java-threads.sh -p &lt;指定的Java Process&gt; -F  
show-busy-java-threads.sh -s &lt;指定jstack命令的全路径&gt;  
# 对于sudo方式的运行，JAVA_HOME环境变量不能传递给root，  
# 而root用户往往没有配置JAVA_HOME且不方便配置，  
# 显式指定jstack命令的路径就反而显得更方便了  
show-busy-java-threads.sh -a &lt;输出记录到的文件&gt;   
show-busy-java-threads.sh -t &lt;重复执行的次数&gt; -i &lt;重复执行的间隔秒数&gt;  
# 缺省执行一次；执行间隔缺省是3秒  
  
##############################  
# 注意：  
##############################  
# 如果Java进程的用户 与 执行脚本的当前用户 不同，则jstack不了这个Java进程。  
# 为了能切换到Java进程的用户，需要加sudo来执行，即可以解决：  
sudo show-busy-java-threads.sh
</code></pre><h1 id="3免费实用的脚本工具大礼包">3、免费实用的脚本工具大礼包</h1>
<p>除了正文提到的 show-busy-java-threads.sh，oldratlee 同学还整合和不少常见的开发、运维过程中涉及到的脚本工具，觉得特别有用的我简单列下：</p>
<h2 id="1show-duplicate-java-classes">（1）show-duplicate-java-classes</h2>
<p>偶尔会遇到本地开发、测试都正常，上线后却莫名其妙的 class 异常，历经千辛万苦找到的原因竟然是 Jar冲突！这个工具就可以找出Java Lib（Java库，即Jar文件）或Class目录（类目录）中的重复类。</p>
<p>Java开发的一个麻烦的问题是Jar冲突（即多个版本的Jar），或者说重复类。会出NoSuchMethod等的问题，还不见得当时出问题。找出有重复类的Jar，可以防患未然。</p>
<pre tabindex="0"><code># 查找当前目录下所有Jar中的重复类show-duplicate-java-classes
# 查找多个指定目录下所有Jar中的重复类
show-duplicate-java-classes path/to/lib_dir1 /path/to/lib_dir2
# 查找多个指定Class目录下的重复类。Class目录 通过 -c 选项指定
show-duplicate-java-classes -c path/to/class_dir1 -c /path/to/class_dir2
# 查找指定Class目录和指定目录下所有Jar中的重复类的Jar
show-duplicate-java-classes path/to/lib_dir1 /path/to/lib_dir2 -c path/to/class_dir1 -c path/to/class_dir2
</code></pre><p>例如：</p>
<pre tabindex="0"><code># 在war模块目录下执行，生成war文件$ mvn install...
# 解压war文件，war文件中包含了应用的依赖的Jar文件$ unzip target/*.war -d target/war...
# 检查重复类$ show-duplicate-java-classes -c target/war/WEB-INF/classes target/war/WEB-INF/lib...
</code></pre><h2 id="2find-in-jars">（2）find-in-jars</h2>
<p>在当前目录下所有jar文件里，查找类或资源文件。</p>
<p>用法：注意，后面Pattern是grep的 扩展正则表达式。</p>
<pre tabindex="0"><code>find-in-jars &#39;log4j\.properties&#39;
find-in-jars &#39;log4j\.xml$&#39; -d /path/to/find/directory
find-in-jars log4j\\.xml
find-in-jars &#39;log4j\.properties|log4j\.xml&#39;
</code></pre><p>示例：</p>
<pre tabindex="0"><code>$ ./find-in-jars &#39;Service.class$&#39;
./WEB-INF/libs/spring-2.5.6.SEC03.jar!org/springframework/stereotype/Service.class
./rpc-benchmark-0.0.1-SNAPSHOT.jar!com/taobao/rpc/benchmark/service/HelloService.class
</code></pre><h2 id="3housemd-pid-java_home">（3）housemd pid [java_home]</h2>
<p>很早的时候，我们使用BTrace排查问题，在感叹BTrace的强大之余，也曾好几次将线上系统折腾挂掉。2012年淘宝的聚石写了HouseMD，将常用的几个Btrace脚本整合在一起形成一个独立风格的应用，其核心代码用的是Scala，HouseMD是基于字节码技术的诊断工具, 因此除了Java以外, 任何最终以字节码形式运行于JVM之上的语言, HouseMD都支持对它们进行诊断, 如Clojure(感谢@Killme2008提供了它的使用入门), scala, Groovy, JRuby, Jython, kotlin等.</p>
<p>使用housemd对java程序进行运行时跟踪，支持的操作有：</p>
<ul>
<li>查看加载类</li>
<li>跟踪方法</li>
<li>查看环境变量</li>
<li>查看对象属性值</li>
<li>详细信息请参考: <a href="https://github.com/CSUG/HouseMD/wiki/UserGuideCN">https://github.com/CSUG/HouseMD/wiki/UserGuideCN</a></li>
</ul>
<h2 id="4jvm-pid">（4）jvm pid</h2>
<p>执行jvm debug工具，包含对java栈、堆、线程、gc等状态的查看，支持的功能有：</p>
<pre tabindex="0"><code>========线程相关=======
1 : 查看占用cpu最高的线程情况
2 : 打印所有线程
3 : 打印线程数
4 : 按线程状态统计线程数
========GC相关=======
5 : 垃圾收集统计（包含原因）可以指定间隔时间及执行次数，默认1秒, 10次
6 : 显示堆中各代的空间可以指定间隔时间及执行次数，默认1秒，5次
7 : 垃圾收集统计。可以指定间隔时间及执行次数，默认1秒, 10次
8 : 打印perm区内存情况*会使程序暂停响应*
9 : 查看directbuffer情况========堆对象相关=======
10 : dump heap到文件*会使程序暂停响应*默认保存到`pwd`/dump.bin,可指定其它路径
11 : 触发full gc。*会使程序暂停响应*
12 : 打印jvm heap统计*会使程序暂停响应*
13 : 打印jvm heap中top20的对象。
*会使程序暂停响应*参数：
	1:按实例数量排序,
	2:按内存占用排序，默认为1
14 : 触发full gc后打印jvm heap中top20的对象。
*会使程序暂停响应*参数：
	1:按实例数量排序,
	2:按内存占用排序，默认为1
15 : 输出所有类装载器在perm里产生的对象。可以指定间隔时间及执行次数
========其它=======
16 : 打印finalzer队列情况
17 : 显示classloader统计
18 : 显示jit编译统计
19 : 死锁检测
20 : 等待X秒，默认为1
</code></pre><p>进入jvm工具后可以输入序号执行对应命令<br>
可以一次执行多个命令，用分号&quot;;&ldquo;分隔，如：1;3;4;5;6<br>
每个命令可以带参数，用冒号&rdquo;:&ldquo;分隔，同一命令的参数之间用逗号分隔，如：</p>
<pre tabindex="0"><code>Enter command queue:1;5:1000,100;10:/data1/output.bin
</code></pre><h2 id="5greysipport">（5）greys[@IP:PORT]</h2>
<p>PS：目前Greys仅支持Linux/Unix/Mac上的Java6+，Windows暂时无法支持</p>
<p>Greys是一个JVM进程执行过程中的异常诊断工具，可以在不中断程序执行的情况下轻松完成问题排查工作。和HouseMD一样，Greys-Anatomy取名同名美剧“实习医生格蕾”，目的是向前辈致敬。代码编写的时候参考了BTrace和HouseMD两个前辈的思路。</p>
<p>使用greys对java程序进行运行时跟踪(不传参数，需要先greys -C pid,再greys)。支持的操作有：</p>
<ul>
<li>
<p>查看加载类，方法信息</p>
</li>
<li>
<p>查看JVM当前基础信息</p>
</li>
<li>
<p>方法执行监控（调用量，失败率，响应时间等）</p>
</li>
<li>
<p>方法执行数据观测、记录与回放（参数，返回结果，异常信息等）</p>
</li>
<li>
<p>方法调用追踪渲染</p>
</li>
<li>
<p>详细信息请参考: <a href="https://github.com/oldmanpushcart/greys-anatomy/wiki">https://github.com/oldmanpushcart/greys-anatomy/wiki</a></p>
</li>
</ul>
<h2 id="6sjksjk---commands-sjk---help">（6）sjksjk &ndash;commands sjk &ndash;help</h2>
<p>使用sjk对Java诊断、性能排查、优化工具</p>
<ul>
<li>
<p>ttop:监控指定jvm进程的各个线程的cpu使用情况</p>
</li>
<li>
<p>jps: 强化版</p>
</li>
<li>
<p>hh: jmap -histo强化版</p>
</li>
<li>
<p>gc: 实时报告垃圾回收信息</p>
</li>
<li>
<p>更多信息请参考: <a href="https://github.com/aragozin/jvm-tools">https://github.com/aragozin/jvm-tools</a></p>
</li>
</ul>

        </div>
    </div>
    </main>

    <style>
        .content {
            font-size: 1.25rem;
          }
          
          .content h1,
          .content h2,
          .content h3,
          .content h4 {
            margin: 15px 10px 5px;
          }
          
    </style>

        <footer class="main-footer footer-type-1 text-xs">
            <div id="footer-tools" class="d-flex flex-column">
                <a href="javascript:" id="go-to-up" class="btn rounded-circle go-up m-1" rel="go-top">
                    <i class="iconfont icon-to-up"></i>
                </a>
                
                <a href="javascript:" data-toggle="modal" data-target="#search-modal" class="btn rounded-circle m-1"
                    rel="search" one-link-mark="yes">
                    <i class="iconfont icon-search"></i>
                </a>
                <a href="https://www.yuque.com/shenweiyan" class="btn rounded-circle kefu m-1" target="_blank" data-toggle="tooltip" data-placement="left" title="联系我们">
                    <i class="mode-ico iconfont icon-qq"></i>
                </a>
                
                
		<a href="javascript:" onclick="window.location.href='javascript:switchNightMode()'" class="btn rounded-circle switch-dark-mode m-1" id="yejian"
                    data-toggle="tooltip" data-placement="left" title="日间模式">
                    <i class="mode-ico iconfont icon-night"></i>
                </a>
                
            </div>
            <div class="footer-inner">
                <div class="footer-text">本站内容源自互联网，如有内容侵犯了你的权益，请联系删除相关内容，联系邮箱：jackxiazhou@yeah.net <br/>© 2023 - 2024 By <a href="https://github.com/shenweiyan/WebStack-Hugo">WebStack-Hugo</a> | <a href="https://www.bioitee.com/">Bio IT 爱好者</a> | <a href="http://beian.miit.gov.cn/">京ICP备17039180号-1</a><br/></div>
            </div>
        </footer>
    </div>
</div>


<script type='text/javascript' src='/assets/js/jquery.ui.touch-punch.min-0.2.2.js' id='jqueryui-touch-js'></script>
<script type='text/javascript' src='/assets/js/clipboard.min-5.6.2.js' id='clipboard-js'></script>
<script type='text/javascript' src='/assets/js/tooltip-extend.js' id='iplaycode-nav-js'></script>
<script type='text/javascript' id='popper-js-extra'>
 

var theme = {"ajaxurl":"","addico":"https:\/\/nav.baidu.cn\/wp-content\/themes\/onenav\/images\/add.png","order":"asc","formpostion":"top","defaultclass":"io-grey-mode","isCustomize":"1","icourl":"","icopng":".png","urlformat":"1","customizemax":"10","newWindow":"0","lazyload":"1","minNav":"1","loading":"1","hotWords":"baidu","classColumns":" col-sm-6 col-md-4 col-xl-5a col-xxl-6a ","apikey":"TWpBeU1UVTNOekk1TWpVMEIvZ1M2bFVIQllUMmxsV1dZelkxQTVPVzB3UW04eldGQmxhM3BNWW14bVNtWk4="};
 
</script>
<script type='text/javascript' src='/assets/js/popper.min.js' id='popper-js'></script>
<script type='text/javascript' src='/assets/js/bootstrap.min-4.3.1.js' id='bootstrap-js'></script>
<script type='text/javascript' src='/assets/js/theia-sticky-sidebar-1.5.0.js' id='sidebar-js'></script>
<script type='text/javascript' src='/assets/js/lazyload.min-12.4.0.js' id='lazyload-js'></script>
<script type='text/javascript' src='/assets/js/fancybox.min-3.5.7.js' id='lightbox-js-js'></script>

<script type='text/javascript' src='/assets/js/app-mini.js' id='appmini-js'></script>

<script type="text/javascript">
    $(document).ready(function(){
        var siteWelcome = $('#loading');
        siteWelcome.addClass('close');
        setTimeout(function() {
            siteWelcome.remove();
        }, 600);
    });
</script>
<script>        
    $(document).ready(function(){
        setTimeout(function () {
            if ($('a.smooth[href="' + window.location.hash + '"]')[0]) {
                $('a.smooth[href="' + window.location.hash + '"]').click();
            }else if (window.location.hash != '') {
                $("html, body").animate({
                    scrollTop: $(window.location.hash).offset().top - 90
                }, {
                    duration: 500,
                    easing: "swing"
                });
            }
        }, 300);
        $(document).on('click','a.smooth',function(ev) {
            if($('#sidebar').hasClass('show') && !$(this).hasClass('change-href')){
                $('#sidebar').modal('toggle');
            }
            if($(this).attr("href").substr(0, 1) == "#"){
                $("html, body").animate({
                    scrollTop: $($(this).attr("href")).offset().top - 90
                }, {
                    duration: 500,
                    easing: "swing"
                });
            }
            if($(this).hasClass('go-search-btn')){
                $('#search-text').focus();
            }
            if(!$(this).hasClass('change-href')){
                var menu =  $("a"+$(this).attr("href"));
                menu.click();
                toTarget(menu.parent().parent(),true,true);
            }
        });
        $(document).on('click','a.tab-noajax',function(ev) {
            var url = $(this).data('link');
            if(url)
                $(this).parents('.d-flex.flex-fill.flex-tab').children('.btn-move.tab-move').show().attr('href', url);
            else
                $(this).parents('.d-flex.flex-fill.flex-tab').children('.btn-move.tab-move').hide();
        });
        
    });
</script>

<script>

(function(){
    if(document.cookie.replace(/(?:(?:^|.*;\s*)night\s*\=\s*([^;]*).*$)|^.*$/, "$1") === ''){
        if(new Date().getHours() > 22 || new Date().getHours() < 6){
            document.body.classList.remove('io-black-mode');
            document.body.classList.add('io-grey-mode');
            document.cookie = "night=1;path=/";
            console.log('夜间模式开启');
        }else{
            document.body.classList.remove('night');
            document.cookie = "night=0;path=/";
            console.log('夜间模式关闭');
        }
    }else{
        var night = document.cookie.replace(/(?:(?:^|.*;\s*)night\s*\=\s*([^;]*).*$)|^.*$/, "$1") || '0';
        if(night == '0'){
            document.body.classList.remove('night');
        }else if(night == '1'){
            document.body.classList.add('night');
        }
    }
})();

$("#search-bg").css("background-image", "url(assets\/images\/bg-dna.jpg)");   
function switchNightMode(){
    var night = document.cookie.replace(/(?:(?:^|.*;\s*)night\s*\=\s*([^;]*).*$)|^.*$/, "$1") || '0';
    if(night == '0'){
	$("#search-bg").css("background-image", "url(assets\/images\/bg-dna.jpg)");
        document.body.classList.remove('io-grey-mode');
        document.body.classList.add('io-black-mode');
        document.cookie = "night=1;path=/"
        console.log(' ');
        $(".switch-dark-mode").attr("data-original-title","日间模式");
        $(".mode-ico").removeClass("icon-night");
        $(".mode-ico").addClass("icon-light");
    }else{
	$("#search-bg").css("background-image", "url(assets\/images\/bg-dna.jpg)")
        document.body.classList.remove('io-black-mode');
        document.body.classList.add('io-grey-mode');
        document.cookie = "night=0;path=/"
        console.log(' ');
        $(".switch-dark-mode").attr("data-original-title","夜间模式");
        $(".mode-ico").removeClass("icon-light");
        $(".mode-ico").addClass("icon-night");
    }
}
</script>
</body>
</html>

