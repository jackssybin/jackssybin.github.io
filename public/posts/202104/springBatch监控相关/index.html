<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1" />
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <meta name="theme-color" content="#f9f9f9" />
    <title>jackssybin网址导航</title>
    <link rel="shortcut icon" href="/assets/images/favicon.ico" />
    <meta name="keywords" content="jackssybin网址导航" />
    
    <meta name="baidu-site-verification" content="codeva-cCAOSG8MBO" />
    
    <link rel="stylesheet" id="block-library-css"
        href="/assets/css/block-library.min-5.6.2.css" type="text/css" media="all" />
    <link rel="stylesheet" id="iconfont-css" href="/assets/css/iconfont-3.03029.1.css"
        type="text/css" media="all" />
    <link rel="stylesheet" id="bootstrap-css" href="/assets/css/bootstrap.min-4.3.1.css"
        type="text/css" media="all" />
    <link rel="stylesheet" id="fancybox-css" href="/assets/css/fancybox.min-3.5.7.css"
        type="text/css" media="all" />
    <link rel="stylesheet" id="iowen-css" href="/assets/css/style-3.03029.1.css"
        type="text/css" media="all" />
    <link rel="stylesheet" id="custom-css" href="/assets/css/custom-style.css"
        type="text/css" media="all" />
    <link rel="stylesheet" id="fortawesome-css" href="/assets/fontawesome-5.15.4/css/all.min.css" type="text/css" />
    <script type="text/javascript" src="/assets/js/jquery.min-3.2.1.js" id="jquery-js"></script>
    <script type="text/javascript" src="/assets/js/content-search.js"  id="content-search-js"></script>
    
    <script>
        
        var _hmt = _hmt || [];
            (function () {
                var hm = document.createElement("script");
                hm.src = "https://hm.baidu.com/hm.js?efccc04cb44fc49faddac5876180b369";
                var s = document.getElementsByTagName("script")[0];
                s.parentNode.insertBefore(hm, s);
            })();
        
    </script>
    
    
     
    
    
    
    
</head>


<div class="main-content flex-fill grid-bg">
    <div class="big-header-banner">
        <div id="header" class="page-header sticky">
            <div class="navbar navbar-expand-md">
                <div class="container-fluid p-0">

                    <a href="" class="navbar-brand d-md-none" title="jackssybin网址导航">
                        <img src="/assets/images/bt.png" class="logo-light"
                            alt="jackssybin网址导航">
                        <img src="/assets/images/bt.png" class="logo-dark d-none"
                            alt="jackssybin网址导航">
                    </a>

                    <div class="collapse navbar-collapse order-2 order-md-1">
                        <div class="header-mini-btn">
                            <label>
                                <input id="mini-button" type="checkbox">
                                <svg viewbox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                                    <path class="line--1" d="M0 40h62c18 0 18-20-17 5L31 55"></path>
                                    <path class="line--2" d="M0 50h80"></path>
                                    <path class="line--3" d="M0 60h62c18 0 18 20-17-5L31 45"></path>
                                </svg>
                            </label>

                        </div>

                        <ul class="navbar-nav site-menu" style="margin-right: 16px;">
                        
			<li >
				<a href="./">
                                    <i class="fa fa-home fa-lg mr-2"></i>
                                    <span>首页</span>
                                </a>
				<ul class="sub-menu">
				
				</ul>
			    </li>
			
			<li >
				<a href="https://www.jackssybin.cn/">
                                    <i class="fa fa-book fa-lg mr-2"></i>
                                    <span>作者</span>
                                </a>
				<ul class="sub-menu">
				
				</ul>
			    </li>
			
			<li class="menu-item-has-children">
				<a href="">
                                    <i class="fa fa-cog fa-lg mr-2"></i>
                                    <span>配置</span>
                                </a>
				<ul class="sub-menu">
				
				    <li><a href="#">源码</a></li>
				
				    <li><a href="#">图标</a></li>
				
				</ul>
			    </li>
			
			</ul>

                        
                        <div class="rounded-circle weather">
                            <div id="he-plugin-simple" style="display: contents;"></div>
                            <script>WIDGET = {
                                    CONFIG: {
                                        "modules": "01234",
                                        "background": 5,
                                        "tmpColor": "E4C600",
                                        "tmpSize": 14,
                                        "cityColor": "E4C600",
                                        "citySize": 14,
                                        "aqiColor": "#E4C600",
                                        "aqiSize": 14,
                                        "weatherIconSize": 24,
                                        "alertIconSize": 18,
                                        "padding": "10px 10px 10px 10px",
                                        "shadow": "1",
                                        "language": "auto",
                                        "borderRadius": 5,
                                        "fixed": "false",
                                        "vertical": "middle",
                                        "horizontal": "left",
                                        "key": "085791e805a24491b43b06cf58ab31e7"
                                    }
                                }
                            </script>
                            <script src="https://widget.qweather.net/simple/static/js/he-simple-common.js?v=2.0"></script>
                        </div>
                        
                    </div>

                    <ul class="nav navbar-menu text-xs order-1 order-md-2">
                        
                        
                        <li class="nav-item mr-3 mr-lg-0 d-none d-lg-block">
                            <script>
                                fetch('https://v1.hitokoto.cn')
                                    .then(response => response.json())
                                    .then(data => {
                                    const hitokoto = document.getElementById('hitokoto_text')
                                    hitokoto.href = 'https://hitokoto.cn/?uuid=' + data.uuid
                                    hitokoto.innerText = data.hitokoto
                                    })
                                    .catch(console.error)
                            </script>                           
                            <div id="hitokoto"><a href="#" target="_blank" id="hitokoto_text">疏影横斜水清浅，暗香浮动月黄昏。</a></div>
                        </li>
                        
                        
                        <li class="nav-search ml-3 ml-md-4">
                            <a href="javascript:" data-toggle="modal" data-target="#search-modal"><i
                                    class="iconfont icon-search icon-2x"></i></a>
                        </li>
                        <li class="nav-item d-md-none mobile-menu ml-3 ml-md-4">
                            <a href="javascript:" id="sidebar-switch" data-toggle="modal"
                                data-target="#sidebar"><i class="iconfont icon-classification icon-2x"></i></a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
        <div class="placeholder" style="height:74px"></div>
    </div>


<body class="page-body boxed-container">
    <main role="main" class="flex-shrink-0">
    <div class="container">
        <h1 class="mt-5"></h1>
        <div class="content">
            <h2 id="permalink-articles202104211618967915021html">title: springBatch监控相关
date: &lsquo;2021-04-21 09:18:35&rsquo;
updated: &lsquo;2021-04-21 09:18:35&rsquo;
tags: [springBatch, prometheus, 自定义监控]
permalink: /articles/2021/04/21/1618967915021.html</h2>
<p><img src="https://b3logfile.com/bing/20200815.jpg?imageView2/1/w/960/h/540/interlace/1/q/100" alt=""></p>
<p>Spring Boot Actuator可以帮助你监控和管理Spring Boot应用，比如健康检查、审计、统计和HTTP追踪等。所有的这些特性可以通过JMX或者HTTP endpoints来获得。</p>
<p>Actuator同时还可以与外部应用监控系统整合，比如 <a href="https://prometheus.io/">Prometheus</a>, <a href="https://graphiteapp.org/">Graphite</a>, <a href="https://www.datadoghq.com/">DataDog</a>, <a href="https://www.influxdata.com/">Influx</a>, <a href="https://www.wavefront.com/">Wavefront</a>, <a href="https://newrelic.com/">New Relic</a>等。这些系统提供了非常好的仪表盘、图标、分析和告警等功能，使得你可以通过统一的接口轻松的监控和管理你的应用。</p>
<p>Actuator使用<a href="http://micrometer.io/">Micrometer</a>来整合上面提到的外部应用监控系统。这使得只要通过非常小的配置就可以集成任何应用监控系统。</p>
<h1 id="预备知识">预备知识:</h1>
<table>
<thead>
<tr>
<th>监控</th>
<th>micrometer</th>
<th>actuator</th>
<th>promethes</th>
</tr>
</thead>
<tbody>
<tr>
<td>概念</td>
<td>类似slf4j门面模式。提供接口和方法</td>
<td>调用micrometer对springboot体系提供了健康检查，对spring体系的扩展。也可以自定义监控。</td>
<td>监控的一类客户端。获取的数据格式需要定制化。micrometer有单独的门面扩展包</td>
</tr>
</tbody>
</table>
<h1 id="1配置pom">1.配置pom</h1>
<pre tabindex="0"><code>&lt;dependency&gt;
    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
    &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt;
&lt;/dependency&gt;
​
&lt;!-- Micrometer Prometheus registry  --&gt;
&lt;dependency&gt;
    &lt;groupId&gt;io.micrometer&lt;/groupId&gt;
    &lt;artifactId&gt;micrometer-registry-prometheus&lt;/artifactId&gt;
&lt;/dependency&gt;
</code></pre><h1 id="2-配置文件">2. 配置文件</h1>
<pre tabindex="0"><code>#支持所有监控  最少需要打开info,metrics,promethes这三个
management.endpoints.web.exposure.include=*
management.endpoints.web.exposure.exclude=env,beans
​
# 单独打开 默认都是关闭
management.endpoints.enabled-by-default=false
management.endpoint.info.enabled=true
​
# 跨域解决
management.endpoints.web.cors.allowed-origins=https://example.com
management.endpoints.web.cors.allowed-methods=GET,POST
​
# 管理端口可调节，也可以直接以 tomcat的端口为准
management.server.port=8089
​
</code></pre><h1 id="3支持的接口">3.支持的接口</h1>
<pre tabindex="0"><code>{
    &#34;_links&#34;: {
        &#34;self&#34;: {
            &#34;href&#34;: &#34;http://localhost:8089/metrics&#34;,
            &#34;templated&#34;: false,
            &#34;desc&#34;:&#34;应用支持的所有监控接口&#34;
        },
        &#34;beans&#34;: {
            &#34;href&#34;: &#34;http://localhost:8089/metrics/beans&#34;,
            &#34;templated&#34;: false,
            &#34;desc&#34;:&#34;应用内所有的Bean 信息&#34;
        },
        &#34;caches-cache&#34;: {
            &#34;href&#34;: &#34;http://localhost:8089/metrics/caches/{cache}&#34;,
            &#34;templated&#34;: true,
            &#34;desc&#34;:&#34;应用的指定缓存信息&#34;
        },
        &#34;caches&#34;: {
            &#34;href&#34;: &#34;http://localhost:8089/metrics/caches&#34;,
            &#34;templated&#34;: false,
            &#34;desc&#34;:&#34;应用的所以缓存信息&#34;
        },
        &#34;health&#34;: {
            &#34;href&#34;: &#34;http://localhost:8089/metrics/health&#34;,
            &#34;templated&#34;: false,
            &#34;desc&#34;:&#34;应用健康的基础信息,应用是否存活&#34;
        },
        &#34;health-path&#34;: {
            &#34;href&#34;: &#34;http://localhost:8089/metrics/health/{*path}&#34;,
            &#34;templated&#34;: true,
            &#34;desc&#34;:&#34;应用&#34;
        },
        &#34;info&#34;: {
            &#34;href&#34;: &#34;http://localhost:8089/metrics/info&#34;,
            &#34;templated&#34;: false,
            &#34;desc&#34;:&#34;&#34;
        },
        &#34;conditions&#34;: {
            &#34;href&#34;: &#34;http://localhost:8089/metrics/conditions&#34;,
            &#34;templated&#34;: false,
            &#34;desc&#34;:&#34;应用内所有bean中带条件的&#34;
        },
        &#34;configprops&#34;: {
            &#34;href&#34;: &#34;http://localhost:8089/metrics/configprops&#34;,
            &#34;templated&#34;: false,
            &#34;desc&#34;:&#34;应用的所以配置相关&#34;
        },
        &#34;env&#34;: {
            &#34;href&#34;: &#34;http://localhost:8089/metrics/env&#34;,
            &#34;templated&#34;: false,
            &#34;desc&#34;:&#34;应用的所以环境信息系统的环境信息，应用的环境信息&#34;
        },
        &#34;env-toMatch&#34;: {
            &#34;href&#34;: &#34;http://localhost:8089/metrics/env/{toMatch}&#34;,
            &#34;templated&#34;: true,
            &#34;desc&#34;:&#34;显示调用env中生效的环境信息http://localhost:8089/metrics/env/local.server.port&#34;
        },
        &#34;loggers&#34;: {
            &#34;href&#34;: &#34;http://localhost:8089/metrics/loggers&#34;,
            &#34;templated&#34;: false,
            &#34;desc&#34;:&#34;应用所有日志相关,日志级别&#34;
        },
        &#34;loggers-name&#34;: {
            &#34;href&#34;: &#34;http://localhost:8089/metrics/loggers/{name}&#34;,
            &#34;templated&#34;: true,
            &#34;desc&#34;:&#34;显示调用日志中生效的日志级别http://localhost:8089/metrics/loggers/com.citicbank.r2dbc&#34;
        },
        &#34;heapdump&#34;: {
            &#34;href&#34;: &#34;http://localhost:8089/metrics/heapdump&#34;,
            &#34;templated&#34;: false,
            &#34;desc&#34;:&#34;提供实时的dump信息&#34;
        },
        &#34;threaddump&#34;: {
            &#34;href&#34;: &#34;http://localhost:8089/metrics/threaddump&#34;,
            &#34;templated&#34;: false,
            &#34;desc&#34;:&#34;提供实时的threaddump信息&#34;
        },
        &#34;metrics-requiredMetricName&#34;: {
            &#34;href&#34;: &#34;http://localhost:8089/metrics/metrics/{requiredMetricName}&#34;,
            &#34;templated&#34;: true,
            &#34;desc&#34;:&#34;指定某一个metrics查看具体的信息&#34;
        },
        &#34;metrics&#34;: {
            &#34;href&#34;: &#34;http://localhost:8089/metrics/metrics&#34;,
            &#34;templated&#34;: false,
            &#34;desc&#34;:&#34;应用内提供的jvm，线程,数据库相关&#34;
        },
        &#34;scheduledtasks&#34;: {
            &#34;href&#34;: &#34;http://localhost:8089/metrics/scheduledtasks&#34;,
            &#34;templated&#34;: false,
            &#34;desc&#34;:&#34;应用指定http://localhost:8089/metrics/metrics/http.server.requests &#34;
        },
        &#34;mappings&#34;: {
            &#34;href&#34;: &#34;http://localhost:8089/metrics/mappings&#34;,
            &#34;templated&#34;: false,
            &#34;desc&#34;:&#34;应用所有对外暴露的接口信息&#34;
        },
        &#34;mappings&#34;: {
            &#34;href&#34;: &#34;http://localhost:8089/metrics/prometheus&#34;,
            &#34;templated&#34;: false,
            &#34;desc&#34;:&#34;应用支持的promethes监控端点,将所有监控metrics数据以promethes需要的格式展示，promethes定时调用此接口实现数据的采集&#34;
        }
    }
}
</code></pre><h3 id="4具体接口">4.具体接口</h3>
<p>请求: <a href="http://localhost:8089/metrics/metrics/http.server.requests">http://localhost:8089/metrics/metrics/http.server.requests</a></p>
<pre tabindex="0"><code>{
    &#34;name&#34;: &#34;http.server.requests&#34;,
    &#34;description&#34;: null,
    &#34;baseUnit&#34;: &#34;seconds&#34;,
    &#34;measurements&#34;: [{
        &#34;statistic&#34;: &#34;COUNT&#34;,
        &#34;value&#34;: 21.0
    }, {
        &#34;statistic&#34;: &#34;TOTAL_TIME&#34;,
        &#34;value&#34;: 1.1525394000000002
    }, {
        &#34;statistic&#34;: &#34;MAX&#34;,
        &#34;value&#34;: 0.0
    }],
    &#34;availableTags&#34;: [{
        &#34;tag&#34;: &#34;exception&#34;,
        &#34;values&#34;: [&#34;None&#34;, &#34;ResponseStatusException&#34;]
    }, {
        &#34;tag&#34;: &#34;method&#34;,
        &#34;values&#34;: [&#34;GET&#34;]
    }, {
        &#34;tag&#34;: &#34;uri&#34;,
        &#34;values&#34;: [&#34;/metrics/loggers/{name}&#34;, &#34;/metrics/threaddump&#34;, &#34;/metrics/heapdump&#34;, &#34;/metrics/configprops&#34;, &#34;/metrics/mappings&#34;, &#34;/metrics/loggers&#34;, &#34;/metrics/metrics&#34;, &#34;/metrics/env&#34;, &#34;/metrics/env/{toMatch}&#34;, &#34;/metrics/metrics/{requiredMetricName}&#34;, &#34;/metrics/info&#34;, &#34;/**&#34;]
    }, {
        &#34;tag&#34;: &#34;outcome&#34;,
        &#34;values&#34;: [&#34;CLIENT_ERROR&#34;, &#34;SUCCESS&#34;]
    }, {
        &#34;tag&#34;: &#34;status&#34;,
        &#34;values&#34;: [&#34;404&#34;, &#34;200&#34;]
    }]
}
</code></pre><h4 id="4-springbatch-接口">4. springBatch 接口</h4>
<p>需要项目运行过job任务。</p>
<p>在源码层次手动注入过，AbstractJob,AbstractStep#excute抽象方法 添加了micrometer 记录方法。
<img src="https://b3logfile.com/file/2021/04/image-20210420184351593-1c113c8d.png" alt="image20210420184351593.png">
<img src="https://b3logfile.com/file/2021/04/image-20210420184243854-88b95ff5.png" alt="image20210420184243854.png">
<img src="https://b3logfile.com/file/2021/04/image-20210420201533923-f869305e.png" alt="image20210420201533923.png"></p>
<p>默认支持</p>
<table>
<thead>
<tr>
<th>metrics name</th>
<th>type</th>
<th><em>Description</em></th>
<th><em>Tags</em></th>
</tr>
</thead>
<tbody>
<tr>
<td>spring.batch.job</td>
<td>TIMER</td>
<td>作业job执行期间</td>
<td>name, status</td>
</tr>
<tr>
<td>spring.batch.job.active</td>
<td>LONG_TASK_TIMER</td>
<td>正在运行的job</td>
<td>name</td>
</tr>
<tr>
<td>spring.batch.step</td>
<td>TIMER</td>
<td>作业step执行情况</td>
<td>name, job.name, status</td>
</tr>
<tr>
<td>spring.batch.item.read</td>
<td>TIMER</td>
<td>作业read情况</td>
<td>job.name, step.name,status</td>
</tr>
<tr>
<td>spring.batch.item.process</td>
<td>TIMER</td>
<td>作业process情况</td>
<td>job.name, step.name,status</td>
</tr>
<tr>
<td>spring.batch.chunk.write</td>
<td>TIMER</td>
<td>作业write情况</td>
<td>job.name, step.name,status</td>
</tr>
</tbody>
</table>
<ol>
<li><a href="http://localhost:8099/actuator/metrics/spring.batch.step">http://localhost:8099/actuator/metrics/spring.batch.step</a>
查看系统中Step的运行情况</li>
</ol>
<pre tabindex="0"><code>{
    &#34;name&#34;: &#34;spring.batch.step&#34;,
    &#34;description&#34;: &#34;Step duration&#34;,
    &#34;baseUnit&#34;: &#34;seconds&#34;,
    &#34;measurements&#34;: [{
        &#34;statistic&#34;: &#34;COUNT&#34;,
        &#34;value&#34;: 1.0
    }, {
        &#34;statistic&#34;: &#34;TOTAL_TIME&#34;,
        &#34;value&#34;: 628.3536165
    }, {
        &#34;statistic&#34;: &#34;MAX&#34;,
        &#34;value&#34;: 628.3536165
    }],
    &#34;availableTags&#34;: [{
        &#34;tag&#34;: &#34;application&#34;,
        &#34;values&#34;: [&#34;testjackssyappname&#34;]
    }, {
        &#34;tag&#34;: &#34;name&#34;,
        &#34;values&#34;: [&#34;testBatchTranscationStep&#34;]
    }, {
        &#34;tag&#34;: &#34;job.name&#34;,
        &#34;values&#34;: [&#34;testBatchTranscation123458888&#34;]
    }, {
        &#34;tag&#34;: &#34;status&#34;,
        &#34;values&#34;: [&#34;COMPLETED&#34;]
    }]
}
</code></pre><ol start="2">
<li><a href="http://localhost:8097/actuator/metrics/spring.batch.job.active">http://localhost:8097/actuator/metrics/spring.batch.job.active</a>
查看系统中的job运行状态</li>
</ol>
<pre tabindex="0"><code>{
    &#34;name&#34;: &#34;spring.batch.job.active&#34;,
    &#34;description&#34;: &#34;Active jobs&#34;,
    &#34;baseUnit&#34;: &#34;seconds&#34;,
    &#34;measurements&#34;: [{
        &#34;statistic&#34;: &#34;ACTIVE_TASKS&#34;,
        &#34;value&#34;: 1.0
    }, {
        &#34;statistic&#34;: &#34;DURATION&#34;,
        &#34;value&#34;: 8.35068088E10
    }],
    &#34;availableTags&#34;: [{
        &#34;tag&#34;: &#34;application&#34;,
        &#34;values&#34;: [&#34;testjackssyappname&#34;]
    }]
}
</code></pre><ol start="3">
<li><a href="http://localhost:8099/actuator/metrics/spring.batch.job">http://localhost:8099/actuator/metrics/spring.batch.job</a>
查看系统运行中job的状况</li>
</ol>
<pre tabindex="0"><code>{
    &#34;name&#34;: &#34;spring.batch.job&#34;,
    &#34;description&#34;: &#34;Job duration&#34;,
    &#34;baseUnit&#34;: &#34;seconds&#34;,
    &#34;measurements&#34;: [{
        &#34;statistic&#34;: &#34;COUNT&#34;,
        &#34;value&#34;: 1.0
    }, {
        &#34;statistic&#34;: &#34;TOTAL_TIME&#34;,
        &#34;value&#34;: 636.9190648
    }, {
        &#34;statistic&#34;: &#34;MAX&#34;,
        &#34;value&#34;: 0.0
    }],
    &#34;availableTags&#34;: [{
        &#34;tag&#34;: &#34;application&#34;,
        &#34;values&#34;: [&#34;testjackssyappname&#34;]
    }, {
        &#34;tag&#34;: &#34;name&#34;,
        &#34;values&#34;: [&#34;testBatchTranscation123458888&#34;]
    }, {
        &#34;tag&#34;: &#34;status&#34;,
        &#34;values&#34;: [&#34;COMPLETED&#34;]
    }]
}
</code></pre><ol start="4">
<li><a href="http://localhost:8099/actuator/prometheus">http://localhost:8099/actuator/prometheus</a>
支持的promethes 接口数据</li>
</ol>
<pre tabindex="0"><code># HELP jvm_memory_committed_bytes The amount of memory in bytes that is committed for  the Java virtual machine to use
# TYPE jvm_memory_committed_bytes gauge
jvm_memory_committed_bytes{area=&#34;nonheap&#34;,id=&#34;Code Cache&#34;,} 9830400.0
jvm_memory_committed_bytes{area=&#34;nonheap&#34;,id=&#34;Metaspace&#34;,} 4.3032576E7
jvm_memory_committed_bytes{area=&#34;nonheap&#34;,id=&#34;Compressed Class Space&#34;,} 6070272.0
jvm_memory_committed_bytes{area=&#34;heap&#34;,id=&#34;PS Eden Space&#34;,} 2.63192576E8
jvm_memory_committed_bytes{area=&#34;heap&#34;,id=&#34;PS Survivor Space&#34;,} 1.2058624E7
jvm_memory_committed_bytes{area=&#34;heap&#34;,id=&#34;PS Old Gen&#34;,} 1.96608E8
# HELP logback_events_total Number of error level events that made it to the logs
# TYPE logback_events_total counter
logback_events_total{level=&#34;error&#34;,} 0.0
logback_events_total{level=&#34;warn&#34;,} 0.0
logback_events_total{level=&#34;info&#34;,} 42.0
logback_events_total{level=&#34;debug&#34;,} 0.0
logback_events_total{level=&#34;trace&#34;,} 0.0
.....
</code></pre><ol start="4">
<li>增加自定义属性</li>
</ol>
<pre tabindex="0"><code>//   spring.application.name =&#34;testjackssyappname&#34;
   @Bean
    MeterRegistryCustomizer&lt;MeterRegistry&gt; configurer(@Value(&#34;${spring.application.name}&#34;) String applicationName){
        return registry -&gt; registry.config().commonTags(&#34;application&#34;, applicationName);
    }
</code></pre><ol start="6">
<li>自定义监控</li>
</ol>
<pre tabindex="0"><code>​
@Component
public class DemoMetrics implements MeterBinder {
    private AtomicLong systemMemoryUsed = new AtomicLong(999);
​
​
    //这里实现了MeterBinder接口的bindTo方法，将要采集的指标注册到MeterRegistry
    // 将此&#34;system.memory.used&#34; 注册到metrics中。通过metrics/system.memory.used 就能   
    @Override
    public void bindTo(MeterRegistry meterRegistry) {
        //这里的MeterRegistry 是全局的
        Gauge.builder(&#34;system.memory.used&#34;, systemMemoryUsed, AtomicLong::get)
//              .tag(&#34;groupName&#34;, this.groupName)
                .description(&#34;系统已用内存（byte）&#34;)
                .register(meterRegistry);
    }
​
    //定时器，定时改变内存数值
    @Scheduled(fixedRate = 1000)
    public void recordMemory() {
        //获取内存信息，省略
        //更改内存
//      systemMemoryUsed.set(physicalUse);
    }
}
</code></pre>
        </div>
    </div>
    </main>

    <style>
        .content {
            font-size: 1.25rem;
          }
          
          .content h1,
          .content h2,
          .content h3,
          .content h4 {
            margin: 15px 10px 5px;
          }
          
    </style>

        <footer class="main-footer footer-type-1 text-xs">
            <div id="footer-tools" class="d-flex flex-column">
                <a href="javascript:" id="go-to-up" class="btn rounded-circle go-up m-1" rel="go-top">
                    <i class="iconfont icon-to-up"></i>
                </a>
                
                <a href="javascript:" data-toggle="modal" data-target="#search-modal" class="btn rounded-circle m-1"
                    rel="search" one-link-mark="yes">
                    <i class="iconfont icon-search"></i>
                </a>
                <a href="https://www.yuque.com/shenweiyan" class="btn rounded-circle kefu m-1" target="_blank" data-toggle="tooltip" data-placement="left" title="联系我们">
                    <i class="mode-ico iconfont icon-qq"></i>
                </a>
                
                
		<a href="javascript:" onclick="window.location.href='javascript:switchNightMode()'" class="btn rounded-circle switch-dark-mode m-1" id="yejian"
                    data-toggle="tooltip" data-placement="left" title="日间模式">
                    <i class="mode-ico iconfont icon-night"></i>
                </a>
                
            </div>
            <div class="footer-inner">
                <div class="footer-text">本站内容源自互联网，如有内容侵犯了你的权益，请联系删除相关内容，联系邮箱：jackxiazhou@yeah.net <br/>© 2023 - 2024 By <a href="https://github.com/shenweiyan/WebStack-Hugo">WebStack-Hugo</a> | <a href="https://www.bioitee.com/">Bio IT 爱好者</a> | <a href="http://beian.miit.gov.cn/">京ICP备17039180号-1</a><br/></div>
            </div>
        </footer>
    </div>
</div>


<script type='text/javascript' src='/assets/js/jquery.ui.touch-punch.min-0.2.2.js' id='jqueryui-touch-js'></script>
<script type='text/javascript' src='/assets/js/clipboard.min-5.6.2.js' id='clipboard-js'></script>
<script type='text/javascript' src='/assets/js/tooltip-extend.js' id='iplaycode-nav-js'></script>
<script type='text/javascript' id='popper-js-extra'>
 

var theme = {"ajaxurl":"","addico":"https:\/\/nav.baidu.cn\/wp-content\/themes\/onenav\/images\/add.png","order":"asc","formpostion":"top","defaultclass":"io-grey-mode","isCustomize":"1","icourl":"","icopng":".png","urlformat":"1","customizemax":"10","newWindow":"0","lazyload":"1","minNav":"1","loading":"1","hotWords":"baidu","classColumns":" col-sm-6 col-md-4 col-xl-5a col-xxl-6a ","apikey":"TWpBeU1UVTNOekk1TWpVMEIvZ1M2bFVIQllUMmxsV1dZelkxQTVPVzB3UW04eldGQmxhM3BNWW14bVNtWk4="};
 
</script>
<script type='text/javascript' src='/assets/js/popper.min.js' id='popper-js'></script>
<script type='text/javascript' src='/assets/js/bootstrap.min-4.3.1.js' id='bootstrap-js'></script>
<script type='text/javascript' src='/assets/js/theia-sticky-sidebar-1.5.0.js' id='sidebar-js'></script>
<script type='text/javascript' src='/assets/js/lazyload.min-12.4.0.js' id='lazyload-js'></script>
<script type='text/javascript' src='/assets/js/fancybox.min-3.5.7.js' id='lightbox-js-js'></script>

<script type='text/javascript' src='/assets/js/app-mini.js' id='appmini-js'></script>

<script type="text/javascript">
    $(document).ready(function(){
        var siteWelcome = $('#loading');
        siteWelcome.addClass('close');
        setTimeout(function() {
            siteWelcome.remove();
        }, 600);
    });
</script>
<script>        
    $(document).ready(function(){
        setTimeout(function () {
            if ($('a.smooth[href="' + window.location.hash + '"]')[0]) {
                $('a.smooth[href="' + window.location.hash + '"]').click();
            }else if (window.location.hash != '') {
                $("html, body").animate({
                    scrollTop: $(window.location.hash).offset().top - 90
                }, {
                    duration: 500,
                    easing: "swing"
                });
            }
        }, 300);
        $(document).on('click','a.smooth',function(ev) {
            if($('#sidebar').hasClass('show') && !$(this).hasClass('change-href')){
                $('#sidebar').modal('toggle');
            }
            if($(this).attr("href").substr(0, 1) == "#"){
                $("html, body").animate({
                    scrollTop: $($(this).attr("href")).offset().top - 90
                }, {
                    duration: 500,
                    easing: "swing"
                });
            }
            if($(this).hasClass('go-search-btn')){
                $('#search-text').focus();
            }
            if(!$(this).hasClass('change-href')){
                var menu =  $("a"+$(this).attr("href"));
                menu.click();
                toTarget(menu.parent().parent(),true,true);
            }
        });
        $(document).on('click','a.tab-noajax',function(ev) {
            var url = $(this).data('link');
            if(url)
                $(this).parents('.d-flex.flex-fill.flex-tab').children('.btn-move.tab-move').show().attr('href', url);
            else
                $(this).parents('.d-flex.flex-fill.flex-tab').children('.btn-move.tab-move').hide();
        });
        
    });
</script>

<script>

(function(){
    if(document.cookie.replace(/(?:(?:^|.*;\s*)night\s*\=\s*([^;]*).*$)|^.*$/, "$1") === ''){
        if(new Date().getHours() > 22 || new Date().getHours() < 6){
            document.body.classList.remove('io-black-mode');
            document.body.classList.add('io-grey-mode');
            document.cookie = "night=1;path=/";
            console.log('夜间模式开启');
        }else{
            document.body.classList.remove('night');
            document.cookie = "night=0;path=/";
            console.log('夜间模式关闭');
        }
    }else{
        var night = document.cookie.replace(/(?:(?:^|.*;\s*)night\s*\=\s*([^;]*).*$)|^.*$/, "$1") || '0';
        if(night == '0'){
            document.body.classList.remove('night');
        }else if(night == '1'){
            document.body.classList.add('night');
        }
    }
})();

$("#search-bg").css("background-image", "url(assets\/images\/bg-dna.jpg)");   
function switchNightMode(){
    var night = document.cookie.replace(/(?:(?:^|.*;\s*)night\s*\=\s*([^;]*).*$)|^.*$/, "$1") || '0';
    if(night == '0'){
	$("#search-bg").css("background-image", "url(assets\/images\/bg-dna.jpg)");
        document.body.classList.remove('io-grey-mode');
        document.body.classList.add('io-black-mode');
        document.cookie = "night=1;path=/"
        console.log(' ');
        $(".switch-dark-mode").attr("data-original-title","日间模式");
        $(".mode-ico").removeClass("icon-night");
        $(".mode-ico").addClass("icon-light");
    }else{
	$("#search-bg").css("background-image", "url(assets\/images\/bg-dna.jpg)")
        document.body.classList.remove('io-black-mode');
        document.body.classList.add('io-grey-mode');
        document.cookie = "night=0;path=/"
        console.log(' ');
        $(".switch-dark-mode").attr("data-original-title","夜间模式");
        $(".mode-ico").removeClass("icon-light");
        $(".mode-ico").addClass("icon-night");
    }
}
</script>
</body>
</html>

